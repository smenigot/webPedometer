$(function(){var e=window.navigator.requestWakeLock("screen");var t=window.innerWidth*5/6;var n=window.innerHeight/2;var r,i;var s=localStorage.podo_stepSize||50,o=localStorage.podo_weight||70;podo_step=localStorage.podo_step||0,podo_speed=localStorage.podo_speed||0,podo_calory=localStorage.podo_calory||0;var u=new Pedometer;var a=new languageApp(window.navigator.language);u.setCountStep(Math.round(podo_step));u.setWeight(Math.round(o));u.setStepSize(Math.round(s));u.setMeanSpeed(Math.round(podo_speed*1e3)/1e3);u.setCalory(Math.round(podo_calory*1e3)/1e3);var f=Backbone.View.extend({el:"body",template:_.template('<section id="index" data-position="current">'+'<section data-type="sidebar">'+"<header>"+'<menu type="toolbar">'+'<a href="#">'+a.$done+"</a>"+"</menu>"+"<h1>Menu</h1>"+"</header>"+"<nav>"+"<ul>"+'<li><a id="btn-pedometer" href="#">'+a.$title+"</a></li>"+'<li><a id="btn-settings" href="#/settings">'+a.$settings+"</a></li>"+'<li><a id="btn-info" href="#/info">'+a.$info+"</a></li>"+"</ul>"+"</nav>"+"</section>"+""+"<!--........................ Drawer ...............................-->"+'<section id="drawer" role="region">'+'<header class="fixed">'+'<a href="#"><span class="icon icon-menu">'+a.$hide+"</span></a>"+'<a href="#drawer"><span class="icon icon-menu">'+a.$show+"</span></a>"+"<h1>"+a.$title+"</h1>"+"</header>"+'<article id="selected" class="content scrollable header">'+'<canvas id="canvas" width="'+t+'" height="'+n+'">'+"</canvas>"+'<table id="dataTable">'+"<tr>"+"<th>"+a.$distance+"<br/>(km)</th>"+"<th>"+a.$meanSpeed+"<br/>(km/h)</th>"+"<th>"+a.$calories+"</th>"+"</tr>"+"<tr>"+'<td><span id="distance-number">0</span></td>'+'<td><span id="speed-number">0</span></td>'+'<td><span id="calory-number">0</span></td>'+"</tr>"+"</table>"+"</div>"+'<div class="settings-btns">'+'<div class="half">'+'<button id="btn-raz" class="danger">'+a.$reinit+"</button>"+"</div>"+"</div>"+"</article>"+"</section> <!-- end drawer -->"+""+"</section> <!-- end index -->"),events:{"click #btn-raz":"reinit"},initialize:function(){$("body").html(this.el);this.render()},render:function(){this.$el.html(this.template())},reinit:function(){podo_step=localStorage.podo_step=0;podo_speed=localStorage.podo_step=0;podo_calory=localStorage.podo_calory=0;u.countStep=0;u.distance=0;u.speed=0;u.meanSpeed=0;u.calory=0;u.stepArr=new Array;$("#distance-number").html(u.distance);$("#calory-number").html(u.calory);$("#speed-number").html(u.meanSpeed);r=document.querySelector("#canvas");i=r.getContext("2d");u.onDraw(i,t,n)}});var l=Backbone.View.extend({template:_.template("<header><h2>"+a.$stepSize+' (cm): <input id="stepSizeLabel" type="number" class="settings-label"></input></h2></header>'+'<div id="stepSizeSlider"></div>'+"<header><h2>"+a.$weight+' (kg): <input id="weightLabel" type="number" class="settings-label"></input></h2></header>'+'<div id="weightSlider"></div>'+"<header><h2></h2></header>"+'<div class="settings-btns">'+'<div class="half">'+'<button id="btn-save">'+a.$save+"</button>"+"</div>"+'<div class="half">'+'<button id="btn-default" class="danger">'+a.$default+"</button>"+"</div>"+"</div>"),events:{"click #btn-save":"save","click #btn-default":"defaults"},initialize:function(){$("#selected").html(this.el);this.render();var e=$("#stepSizeLabel"),t=$("#weightLabel");$("#stepSizeSlider").noUiSlider({range:[30,100],start:[50],handles:1,step:1,serialization:{resolution:1,to:e}});$("#weightSlider").noUiSlider({range:[30,150],start:[70],handles:1,step:1,serialization:{resolution:1,to:t}});$("#stepSizeSlider").val(s);$("#weightSlider").val(o)},render:function(){this.$el.html(this.template())},save:function(){s=localStorage.podo_stepSize=$("#stepSizeSlider").val();o=localStorage.podo_weight=$("#weightSlider").val();$("header.fixed h1").append("<section role='status'><p><strong>"+a.$changesSaved+"</strong>.</p></section>");setTimeout(function(){$('[role="status"]').remove()},2e3)},defaults:function(){s=localStorage.podo_stepSize=80;o=localStorage.podo_weight=70;$("#stepSizeSlider").val(s);$("#weightSlider").val(o);$("header.fixed h1").append("<section role='status'><p>"+a.$defaultLoaded+".</p></section>");setTimeout(function(){$('[role="status"]').remove()},2e3)}});var c=Backbone.View.extend({template:_.template("<header><h1>"+a.$info+"</h1></header>"+"<p>"+a.$help+"</p>"),initialize:function(){$("#selected").html(this.el);this.render()},render:function(){this.$el.html(this.template())}});var h=Backbone.Router.extend({routes:{"":"home",settings:"settings",info:"info"},home:function(){this.view=new f},settings:function(){this.view=new l},info:function(){this.view=new c},about:function(){this.view=new AboutView}});var p=new h;Backbone.history.start();r=document.querySelector("#canvas");i=r.getContext("2d");u.onDraw(i,t,n);var d=0;if(window.DeviceOrientationEvent){window.addEventListener("devicemotion",function(e){if(u.acc_norm.length<2||u.stepArr.length<2){u.createTable(Math.round(2/(e.interval/1e3)))}else{d=u.computeNorm(e.accelerationIncludingGravity.x,e.accelerationIncludingGravity.y,e.accelerationIncludingGravity.z);u.acc_norm.push(d);u.update();u.onStep(u.acc_norm);u.onSpeed();u.onCalory();r=document.querySelector("#canvas");i=r.getContext("2d");u.onDraw(i,t,n);if(localStorage.podo_step!==0&&isNaN(u.countStep)==0){podo_step=localStorage.podo_step=u.countStep}if(localStorage.podo_speed!==0&&isNaN(u.meanSpeed)==0){podo_speed=localStorage.podo_speed=u.meanSpeed}if(localStorage.podo_calory!==0&&isNaN(u.calory)==0){podo_calory=localStorage.podo_calory=u.calory}if(isNaN(u.distance)==0){$("#distance-number").html(Math.round(u.distance/100)/1e3)}else{$("#distance-number").html(0)}if(isNaN(u.meanSpeed)==0){$("#speed-number").html(Math.round(u.meanSpeed/1e3*3600))}else{$("#speed-number").html(0)}if(isNaN(u.calory)==0){$("#calory-number").html(Math.round(u.calory))}else{$("#calory-number").html(0)}}},false)}})